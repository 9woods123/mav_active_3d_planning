# Base config for final weight planner

# Planner node
replan_pos_threshold: 0.15
replan_yaw_threshold: 0.15

max_new_segments: 0   # todo
min_new_segments: 0
max_new_tries: 0
min_new_tries: 0
min_new_value: 0

verbose_modules: true
build_modules_on_init: true
expand_batch: 1
visualize_gain: true
highlight_executed_trajectory: true

# TG
trajectory_generator:
  collision_optimistic: false  # todo
  collision_radius: 1.0
  clearing_radius: 0.5
  
  type: "FeasibleRRTStar"
  all_semgents_feasible: false
  crop_segments: true
  crop_margin: 0.3
  crop_min_length: 0.5
  max_extension_range: 1.5
  maximum_tries: 1000
  sampling_rate: 20.0
  sample_yaw: true
  
  sampling_mode: "semilocal"
  semilocal_sampling_count: 10
  semilocal_sampling_radius_max: 1.5
  semilocal_sampling_radius_min: 1.5
  
  rewire_root: true
  rewire_intermediate: true
  reinsert_root: true
  max_rewire_range: 1.6
  max_density_range: 0.0
  n_neighbors: 20
  
  bounding_volume_args: "/map_bounding_volume"

  generator_updater:
    type: "RecheckCollision"
    
  system_constraints_args: "/planner/system_constraints"
  
# TE
trajectory_evaluator:
  type: "RRTStarEvaluatorAdapter"
  
  following_evaluator:
    type: "ContinuousYawPlanningEvaluator"
    n_directions: 16
    n_sections_fov: 3
    select_by_value: false
    update_range: 3.0
    update_gain: 0.0
    update_sections_separate: false
    
    following_evaluator:
      type: "VoxelWeightEvaluator"
      clear_from_parents: false
      visualize_sensor_view: true
      accurate_frontiers: true 
      checking_distance: 2.0
      frontier_voxel_weight: 1.1
      new_voxel_weight: 0.0
      min_impact_factor: 0.01
      ray_angle_x: 0.00217
      ray_angle_y: 0.00232
      use_frontier_voxels: true
      
      bounding_volume_args: "/target_bounding_volume"      
#      bounding_volume:
#        x_min: -1.079
#        x_max: 0.914
#        y_min: -4.983
#        y_max: 1.079
#        z_min: -1.000
#        z_max: 1.000
#        rotation: 85.269
     
      sensor_model:
        type: "IterativeRayCaster"
        sampling_time: 0.0
        ray_length: 4.8
        focal_length: 385.0
        # full fov
#        resolution_x: 181 # 640-79.4 / 181 cont yaw 12
#        resolution_y: 480 # 480-63.8
        # reduced fov
#        resolution_x: 164 # 560-72 / 164 cont yaw 15/3, 250 cont yaw 10/2
#        resolution_y: 446 # 446-60
        # more reduced fov (depth)
        resolution_x: 153 # 514-67.5 / 153 cont yaw 16/3
        resolution_y: 200 # 280-40, 200-30
        downsampling_factor: 3.0
        
        # relative to imu, requires imu coord shift...
#        mounting_translation_x: 0.009552984223402516
#        mounting_translation_y: -0.004970312430909841
#        mounting_translation_z: -0.1486855190135599
#        mounting_rotation_x: -0.5627113
#        mounting_rotation_y: 0.564155
#        mounting_rotation_z: -0.4185156
#        mounting_rotation_w: 0.4358093
        mounting_translation_x: 0.15
        mounting_translation_y: 0.0
        mounting_translation_z: 0.0
        mounting_rotation_x: 0
        mounting_rotation_y: 0.1305262
        mounting_rotation_z: 0
        mounting_rotation_w: 0.9914449
        
      cost_computer:
        type: "SegmentTime"
          
      value_computer:
        type: "GlobalNormalizedGain"
        
      next_selector:
        type: "SubsequentBest"

back_tracker:
  type: "FeasibleRotateReverse"
  turn_rate: 0.3
  update_rate: 0.5
  sampling_rate: 20.0
  n_rotations: 0
  stack_size: 10
  system_constraints_args: "/planner/system_constraints"

