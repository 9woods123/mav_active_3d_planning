# Base config for final weight planner

# Planner node
replan_pos_threshold: 0.12
replan_yaw_threshold: 0.12

max_new_segments: 0
min_new_segments: 0
max_new_tries: 100
min_new_tries: 0
min_new_value: 0

verbose_modules: true
build_modules_on_init: true
expand_batch: 1

# TG
trajectory_generator:
  collision_optimistic: false 
  collision_radius: 1.2
  clearing_radius: 0.5
  
  bounding_volume:
        x_min: -2.75
        x_max: 2.25
        y_min: -2.6
        y_max: 1
        z_min: 0.3
        z_max: 2.75
        
  system_constraints:
    v_max: 0.5
    a_max: 0.5
    yaw_rate_max: 0.7
  
  type: "FeasibleRRTStar"
  crop_segments: true
  crop_margin: 0.5
  crop_min_length: 0.2
  max_extension_range: 2.0
  maximum_tries: 1000
  sampling_rate: 20.0
  sample_yaw: true
  
  sampling_mode: "spheric"
  semilocal_sampling_count: 10
  semilocal_sampling_radius_max: 1.5
  semilocal_sampling_radius_min: 0.3
  
  rewire_root: true
  rewire_intermediate: true
  max_rewire_range: 2.1
  n_neighbors: 10

  generator_updater:
    type: "RecheckCollision"
  
# TE
trajectory_evaluator:
  type: "RRTStarEvaluatorAdapter"
  
  following_evaluator:
    type: "SimpleYawPlanningEvaluator"
    n_directions: 4
    select_by_value: false
    
    following_evaluator:
      bounding_volume:
        x_min: 0
        x_max: 0
        y_min: 0
        y_max: 0
        z_min: 0
        z_max: 0
        
      type: "VoxelWeightEvaluator"
      clear_from_parents: false
      visualize_sensor_view: true
      accurate_frontiers: true 
      
      frontier_voxel_weight: 10.0
      new_voxel_weight: 0.01
      min_impact_factor: 0.05
      ray_angle_x: 0.002454
      ray_angle_y: 0.002681
      use_frontier_voxels: false
       
      sensor_model:
        mounting_translation_x: -0.00607641 
        mounting_translation_y: -0.0106566
        mounting_translation_z: 0.133374

        mounting_rotation_x: -0.00186232
        mounting_rotation_y: 0.0669071
        mounting_rotation_z: 0.00972055
        mounting_rotation_w: 0.99771
        
#        type: "IterativeRayCaster"
#        sampling_time: 0.0
#        ray_length: 5.0
#        focal_length: 320.0
#        resolution_x: 640 # h_fov 90 deg
#        resolution_y: 172 # Results in v_fov 30
#        downsampling_factor: 3.0

        type: "IterativeRayCasterLidar"
        sampling_time: 0.0
        ray_length: 5.0
        field_of_view_x: 360.0
        field_of_view_y: 30.0
        resolution_x: 1024
        resolution_y: 128
        downsampling_factor: 3.0
        
      cost_computer:
        type: "SegmentTime"
          
      value_computer:
        type: "RelativeGain"
        accumulate: true
        
      next_selector:
        type: "SubsequentBest"
        
      evaluator_updater:
        type: "YawPlanningUpdater"
        select_by_value: false
        dynamic_trajectories: true
        following_updater:
          type: "UpdateAll"
          update_gain: true
          update_cost: false
          update_value: true

back_tracker:
  type: "RotateReverse"
  turn_rate: 0.7
  update_rate: 2.0
  sampling_rate: 20.0
  n_rotations: 1
  stack_size: 10

